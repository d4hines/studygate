# SurveyGate

SurveyGate is is a full-stack Clojure(Script) app that uses the [Fulcro framework](https://github.com/fulcrologic/fulcro), a batteries-included inheritor of Om Next.

FIXME: See it live here.

## The Scenario

Many institutions use Microsoft's Dynamics CRM to manage the enormous and complex data required and generated by clincial research. It's flexibilty, ease of use, and existing third-party solutions (such as [SAGlobal's](http://www.saglobal.us/industries/contract-research-organizations.html)) make it a natural choice, especially in the realm of managing participant information and outcomes.

Since this is the case, and since every participants' journey in a clinical study begins with collecting their personal information (usually lots of it), wouldn't it be nice if there was a clean, easy interface for particpants to enter their data automaticaly persisted to the CRM?

## The Solution

Enter SurveyGate, an online survey inteface backed by Dynamics CRM. It is entirely data-driven - each survey is a pure function of the CRM's metadata, allowing the end users (in this case, the researchers) to define the survey as a normal CRM entity via a familiar drag-and-drop interface, and let SurveyGate handle the rest. The stored data is just normal CRM data, allowing users to leverage all the OOB techniques CRM provides for custom business logic, reporting, and even integrations with email, Zapier, etc.

## The Tech

- Clojure and ClojureScript
- [fulcro](https://github.com/fulcrologic/fulcro)
- [figwheel](https://github.com/bhauman/lein-figwheel)
- [SCSS](https://github.com/sass/node-sass)
- [dynamics-clj](https://github.com/d4hines/dynamics-clj) (a helper library I wrote for working with the CRM Web API)

## Why this is Awesome

### UI through Pure Functions!

Fulcro's data-driven story is amazing: you write a component as pure function of its colocatted query, and the underlying machinery reconciles them against a normalized database atom. Mutations against this database are an `assoc-in` cake-walk.

### Content through Pure Functions!

SurveyGate has exactly two concerns: pure rendering of CRM metadata, and writing user input back to CRM. Let the experts (the end users) define what data is important to them, how it should be collected and used. Surveys can be modified and deployed with a button-click.

## Running it

### Figwheel/Clojurescript Build

Start figwheel (the JVM options tell figwheel which builds to run):

```
JVM_OPTS="-Ddev -Dtest" lein run -m clojure.main script/figwheel.clj
```

which should start auto-building the cljs source and show a browser REPL.

You can do this in IntelliJ using a regular Clojure Main REPL that runs
`script/figwheel.clj` (Parameters field). Put the `-Ddev` and `-Dtest` options can go in the JVM
arguments field.

Our internal figwheel support uses Java system properties to select the
builds you want to start (so you can create multiple run profiles for
different tasks that target only specific builds). The supported build IDs
are whatever builds are defined in the project file (it extracts build 
configurations from there). So, including `-Dtest` in the JVM arguments
will include the build of tests.

### Server

Start a CLJ REPL (e.g. command line or IntelliJ):

```
lein repl
```

At the REPL, start the server:

```
(go)
```

Navigate to: [http://localhost:3000/index.html](http://localhost:3000/)

If you make changes to the source code hot code reload will re-render without a browser reload.

Changes to server code can be put into effect at the REPL (NOTE: will wipe database) with:

```
(restart)
```
## Fulcro Inspect Integration

While in dev mode you should be able to press CTRL-F to pop open inspection tools. These
let you view the network interactions from a Fulcro perspective, browse the app
database, and other things.

## Credit

Based on Tony Kay's TodoMVC implementation, of which this is a fork.

Many thanks to guys on Clojurian #beginners and #fulcro for enduring my pestering.

But most of all:

SDG
